name: LeetCode Master Sync

on:
  workflow_dispatch:
  schedule:
    - cron: "0 8 * * *"

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      # STEP 1: Sync Code Files (This repo is stable)
      - name: Sync Code Files
        uses: dos-m0nk3y/LeetCode-Synchronizer@v1.1.0
        with:
          GITHUB_TOKEN: ${{ github.token }}
          LEETCODE_SESSION: ${{ secrets.LEETCODE_SESSION }}
          LEETCODE_CSRF_TOKEN: ${{ secrets.LEETCODE_CSRF_TOKEN }}

      # STEP 2: Custom Python Stats Updater (No external Action needed!)
      - name: Update README Stats
        run: |
          python -c "
          import requests
          import re

          user = 'Asmit_S'
          resp = requests.get(f'https://leetcode-stats-api.herokuapp.com/{user}').json()
          if resp['status'] == 'success':
              stats = f'\n| Difficulty | Solved | Total |\n| :--- | :--- | :--- |\n| ðŸŸ¢ Easy | {resp[\"easySolved\"]} | {resp[\"totalEasy\"]} |\n| ðŸŸ¡ Medium | {resp[\"mediumSolved\"]} | {resp[\"totalMedium\"]} |\n| ðŸ”´ Hard | {resp[\"hardSolved\"]} | {resp[\"totalHard\"]} |\n| **Total** | **{resp[\"totalSolved\"]}** | **{resp[\"totalQuestions\"]}** |\n'
              with open('README.md', 'r') as f:
                  content = f.read()
              new_content = re.sub(r'.*?', f'{stats}', content, flags=re.DOTALL)
              with open('README.md', 'w') as f:
                  f.write(new_content)
          "

      # STEP 3: Commit and Push
      - name: Commit and Push
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add .
          git commit -m "Sync: Solutions and Stats updated" || echo "No changes"
          git push